--// MAIN DEATHRUN RENDERER (By StarManiaKG and NARBlueBear) //--
--// VARIABLES
-- Links
local DR = DeathRun

local DRM = DeathRun.Match

--NAR here again. Time to play with hud.add(). //Redone by Star :)
--First off, we are going to make a main game HUD.
hud.add(function(v)
	local player = consoleplayer
	
	if (tol == TOL_DEATHRUN or gametype == GT_DEATHRUN) then
		-- Renders For Everyone --
		if (player and player.valid) then
			-- Player Count
			v.drawString(155, 0, "Players Alive", V_YELLOWMAP|V_SNAPTORIGHT|V_PERPLAYER)
			v.drawString(160, 8, "Red Team: \$DRM.redteamMembers\", V_REDMAP|V_SNAPTORIGHT|V_PERPLAYER)
			v.drawString(160, 16, "Blue Team: \$DRM.blueteamMembers\", V_BLUEMAP|V_SNAPTORIGHT|V_PERPLAYER)
			v.drawString(126, 24, (DR.ActualMatchStatus == "waiting" and "Waiting For Players\$player.dot\" or "Deathun Match Started!"), (DR.ActualMatchStatus == "waiting" and V_ROSYMAP or V_GREENMAP)|V_SNAPTORIGHT|V_PERPLAYER)
			
			-- Alerts
			v.drawString(68, 80, "ALERTS", V_REDMAP|V_SNAPTOLEFT|V_PERPLAYER)
			
			if (player.ctfteam) then
				if (player.ctfteam == 1) then
					if (player.rwarning) then v.drawString(68, 70, "RUNNERS INCOMING", V_BLUEMAP|V_SNAPTOLEFT|V_PERPLAYER) end
				else
					if (player.twarning) then v.drawString(68, 70, "APPROACHING TRAPERS", V_REDMAP|V_SNAPTOLEFT|V_PERPLAYER) end
				end
			end
			
			-- Skins
			//v.draw(30, 30, v.getSprite2Patch(player.skin, "XTRA", false, C, 0, 0), V_SNAPTORIGHT|V_SNAPTOBOTTOM, v.getColormap(player.skin, skins[player.skin].prefcolor))
			v.draw(30, 30, v.getSprite2Patch(player.skin, "LIFE", false, A, 0, 0), V_SNAPTORIGHT|V_SNAPTOBOTTOM, v.getColormap(player.skin, skins[player.skin].prefcolor))
		end

		-- Renders For Specific Players Only --
		-- Abilities
		if (player.mo and player.mo.valid) then
			if (player.charability) then
				if (player.charability == 1) then
					v.drawString(68, 136, (player.thokcooldown and "Thok: \$G_TicsToSeconds(player.thokcooldown)\ Second Cooldown" or "Thok: READY TO USE!"), V_SKYMAP|V_SNAPTOLEFT|V_PERPLAYER)
				elseif (player.charability == 2) then
					v.drawString(68, 136, "FLIGHT: \$player.flyhightime\ Presses Left", V_ORANGEMAP|V_SNAPTOLEFT|V_PERPLAYER)
				elseif (player.charability == 3) then
					v.drawString(68, 136, (player.mo.eflags & MFE_UNDERWATER and "SWIMMING: \$player.swimming\" or "GLIDE: \$player.gliding\"), V_REDMAP|V_SNAPTOLEFT|V_PERPLAYER)
				end
			else
				v.drawString(68, 136, "No Ability!", V_SKYMAP|V_SNAPTOLEFT|V_PERPLAYER)
			end
		end
    end
end, "game")

--Now, we are going to do make a intermission HUD hook.
hud.add(function(v)
    if gametype == GT_DEATHRUN then
		v.drawString(120, 5, "The " + ((DRM.redteamMembers and not DRM.blueteamMembers) and "Trappers " or "Runners ") + "Win!", ((DRM.redteamMembers and not DRM.blueteamMembers) and V_REDMAP or V_BLUEMAP)|V_SNAPTOLEFT|V_PERPLAYER)
    end
end, "intermission")

--Now it's time to execute some stuff through Lua //As mentioned in the HUD hook, these are the hook that sets the alerts :)
addHook("LinedefExecute", function(line, mobj)
	if mobj and mobj.valid and maptol == TOL_DEATHRUN then mobj.player.rwarning = true end
end, "RWARNING")
addHook("LinedefExecute", function(line, mobj)
	if mobj and mobj.valid and maptol == TOL_DEATHRUN then mobj.player.twarning = true end
end, "TWARNING")
